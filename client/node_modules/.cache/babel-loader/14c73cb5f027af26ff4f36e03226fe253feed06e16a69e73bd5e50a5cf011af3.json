{"ast":null,"code":"import React,{useState,useEffect}from'react';import ProfileOrderButtons from\"../../components/admin/ProfileOrderButtons\";import{Container,Box,Button,Grid,Card,CardContent,CardActions,CircularProgress,Alert,IconButton,Typography,Tooltip}from'@mui/material';import{Add as AddIcon,Edit as EditIcon,Delete as DeleteIcon,Check as CheckIcon,Block as BlockIcon,VerifiedUser as VerifiedIcon,ArrowUpward as ArrowUpIcon,ArrowDownward as ArrowDownIcon}from\"@mui/icons-material\";import{api}from'../../utils/api';import ProfileEditor from'../../components/admin/ProfileEditor';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProfilesPage=()=>{const[profiles,setProfiles]=useState([]);const[cities,setCities]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[openEditor,setOpenEditor]=useState(false);const[selectedProfile,setSelectedProfile]=useState(null);useEffect(()=>{fetchProfiles();fetchCities();},[]);const fetchProfiles=async()=>{try{const response=await api.get('/admin/profiles');setProfiles(response.data);}catch(error){console.error('Error fetching profiles:',error);setError('Ошибка при загрузке анкет');}finally{setLoading(false);}};const fetchCities=async()=>{try{const response=await api.get('/cities');setCities(response.data);}catch(error){console.error('Error fetching cities:',error);}};const handleOpenEditor=profile=>{if(profile){setSelectedProfile(profile);}else{setSelectedProfile(null);}setOpenEditor(true);};const handleCloseEditor=()=>{setOpenEditor(false);setSelectedProfile(null);};const handleSaveProfile=async profileData=>{try{if(selectedProfile){await api.put(`/admin/profiles/${selectedProfile.id}`,profileData);}else{await api.post('/admin/profiles',profileData);}fetchProfiles();handleCloseEditor();}catch(error){console.error('Error saving profile:',error);setError('Ошибка при сохранении анкеты');}};const handleDelete=async id=>{if(!window.confirm('Вы уверены, что хотите удалить эту анкету?')){return;}try{await api.delete(`/admin/profiles/${id}`);fetchProfiles();}catch(error){console.error('Error deleting profile:',error);setError('Ошибка при удалении анкеты');}};const handleMoveUp=async id=>{try{await api.patch(`/admin/profiles/${id}/moveUp`);fetchProfiles();// Обновляем список профилей\n}catch(error){console.error(\"Error moving profile up:\",error);setError(\"Ошибка при перемещении анкеты вверх\");}};const handleMoveDown=async id=>{try{await api.patch(`/admin/profiles/${id}/moveDown`);fetchProfiles();// Обновляем список профилей\n}catch(error){console.error(\"Error moving profile down:\",error);setError(\"Ошибка при перемещении анкеты вниз\");}};const handleToggleStatus=async profile=>{try{await api.put(`/admin/profiles/${profile.id}`,{isActive:!profile.isActive});fetchProfiles();}catch(error){console.error('Error toggling profile status:',error);setError('Ошибка при изменении статуса анкеты');}};const handleToggleVerification=async profile=>{try{await api.put(`/admin/profiles/${profile.id}`,{isVerified:!profile.isVerified});fetchProfiles();}catch(error){console.error('Error toggling verification status:',error);setError('Ошибка при изменении статуса верификации');}};if(loading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",children:[/*#__PURE__*/_jsxs(Box,{sx:{mb:4,display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:\"\\u0423\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0430\\u043D\\u043A\\u0435\\u0442\\u0430\\u043C\\u0438\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>handleOpenEditor(),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0430\\u043D\\u043A\\u0435\\u0442\\u0443\"})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:profiles.map(profile=>{var _cities$find;return/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,children:[profile.name,\", \",profile.age,\" \\u043B\\u0435\\u0442\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"\\u0413\\u043E\\u0440\\u043E\\u0434: \",(_cities$find=cities.find(c=>c.id===profile.cityId))===null||_cities$find===void 0?void 0:_cities$find.name]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D: \",profile.phone]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1,mt:1},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441: \",profile.isActive?'Активна':'Неактивна']}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"\\u2022 \",profile.isVerified?'Проверена':'Не проверена']})]})]}),/*#__PURE__*/_jsxs(CardActions,{children:[/*#__PURE__*/_jsx(Tooltip,{title:\"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleOpenEditor(profile),size:\"small\",children:/*#__PURE__*/_jsx(EditIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleDelete(profile.id),size:\"small\",color:\"error\",children:/*#__PURE__*/_jsx(DeleteIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:profile.isActive?\"Деактивировать\":\"Активировать\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleToggleStatus(profile),size:\"small\",color:profile.isActive?\"success\":\"warning\",children:profile.isActive?/*#__PURE__*/_jsx(CheckIcon,{}):/*#__PURE__*/_jsx(BlockIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:profile.isVerified?\"Отменить проверку\":\"Подтвердить проверку\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleToggleVerification(profile),size:\"small\",color:profile.isVerified?\"success\":\"default\",children:/*#__PURE__*/_jsx(VerifiedIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u041F\\u0435\\u0440\\u0435\\u043C\\u0435\\u0441\\u0442\\u0438\\u0442\\u044C \\u0432\\u0432\\u0435\\u0440\\u0445\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleMoveUp(profile.id),size:\"small\",children:/*#__PURE__*/_jsx(ArrowUpIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"\\u041F\\u0435\\u0440\\u0435\\u043C\\u0435\\u0441\\u0442\\u0438\\u0442\\u044C \\u0432\\u043D\\u0438\\u0437\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleMoveDown(profile.id),size:\"small\",children:/*#__PURE__*/_jsx(ArrowDownIcon,{})})}),/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id,onSuccess:fetchProfiles,onError:setError}),/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id,onSuccess:fetchProfiles,onError:setError})]})]})},profile.id);})}),/*#__PURE__*/_jsx(ProfileEditor,{profile:selectedProfile||undefined,open:openEditor,onClose:handleCloseEditor,onSave:handleSaveProfile})]});};export default ProfilesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}