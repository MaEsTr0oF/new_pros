{"ast":null,"code":"import ProfileOrderButtons from\"../components/admin/ProfileOrderButtons\";import React,{useState,useEffect}from'react';import{Container,Paper,Typography,Box,Button,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Alert}from'@mui/material';import{Edit as EditIcon,Delete as DeleteIcon,Add as AddIcon}from'@mui/icons-material';import axios from'axios';import{API_URL}from'../../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CitiesPage=()=>{const[cities,setCities]=useState([]);const[open,setOpen]=useState(false);const[editingCity,setEditingCity]=useState(null);const[error,setError]=useState('');const token=localStorage.getItem('adminToken');const fetchCities=async()=>{try{const response=await axios.get(`${API_URL}/cities`);setCities(response.data);}catch(error){console.error('Error fetching cities:',error);setError('Ошибка при загрузке городов');}};useEffect(()=>{fetchCities();},[]);const handleOpen=city=>{setEditingCity(city||{name:''});setOpen(true);};const handleClose=()=>{setEditingCity(null);setOpen(false);setError('');};const handleSave=async()=>{if(!(editingCity!==null&&editingCity!==void 0&&editingCity.name))return;try{const headers={Authorization:`Bearer ${token}`};if(editingCity.id){await axios.put(`${API_URL}/admin/cities/${editingCity.id}`,editingCity,{headers});}else{await axios.post(`${API_URL}/admin/cities`,editingCity,{headers});}fetchCities();handleClose();}catch(error){console.error('Error saving city:',error);setError('Ошибка при сохранении города');}};const handleDelete=async id=>{if(!window.confirm('Вы уверены, что хотите удалить этот город?'))return;try{const headers={Authorization:`Bearer ${token}`};await axios.delete(`${API_URL}/admin/cities/${id}`,{headers});fetchCities();}catch(error){console.error('Error deleting city:',error);setError('Ошибка при удалении города');}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",children:[/*#__PURE__*/_jsxs(Box,{sx:{mb:4,display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:\"\\u0423\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430\\u043C\\u0438\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>handleOpen(),children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0433\\u043E\\u0440\\u043E\\u0434\"})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"ID\"}),/*#__PURE__*/_jsx(TableCell,{children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(TableCell,{children:\"\\u041A\\u043E\\u043B-\\u0432\\u043E \\u0430\\u043D\\u043A\\u0435\\u0442\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:cities.map(city=>{var _city$_count;return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:city.id}),/*#__PURE__*/_jsx(TableCell,{children:city.name}),/*#__PURE__*/_jsx(TableCell,{children:((_city$_count=city._count)===null||_city$_count===void 0?void 0:_city$_count.profiles)||0}),/*#__PURE__*/_jsxs(TableCell,{align:\"right\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleOpen(city),children:/*#__PURE__*/_jsx(EditIcon,{})}),\" \",/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id}),/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",color:\"error\",onClick:()=>handleDelete(city.id),children:/*#__PURE__*/_jsx(DeleteIcon,{})}),\" \",/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id}),/*#__PURE__*/_jsx(ProfileOrderButtons,{profileId:profile.id})]})]},city.id);})})]})}),/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingCity!==null&&editingCity!==void 0&&editingCity.id?'Редактировать город':'Добавить город'}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430\",fullWidth:true,value:(editingCity===null||editingCity===void 0?void 0:editingCity.name)||'',onChange:e=>setEditingCity({...editingCity,name:e.target.value})})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSave,variant:\"contained\",children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"})]})]})]});};export default CitiesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}