{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{Box,Container,Grid,Typography,CircularProgress,Alert,styled,Breadcrumbs,Link as MuiLink}from'@mui/material';import{API_URL}from'../config';import CommonSEO from'../components/SEO/CommonSEO';import ProfileCard from'../components/ProfileCard';import Header from'../components/Header';import FilterBar from'../components/FilterBar';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PageContainer=styled(Box)(_ref=>{let{theme}=_ref;return{minHeight:'100vh',backgroundColor:theme.palette.background.default};});const ContentContainer=styled(Container)(_ref2=>{let{theme}=_ref2;return{paddingTop:theme.spacing(3),paddingBottom:theme.spacing(6)};});const LoadingContainer=styled(Box)(_ref3=>{let{theme}=_ref3;return{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',minHeight:'50vh',gap:theme.spacing(2)};});const StyledAlert=styled(Alert)(_ref4=>{let{theme}=_ref4;return{marginBottom:theme.spacing(3)};});const BreadcrumbsContainer=styled(Box)(_ref5=>{let{theme}=_ref5;return{marginBottom:theme.spacing(3)};});const initialFilters={gender:[],appearance:{age:[18,45],height:[150,190],weight:[40,80],breastSize:[1,10],nationality:[],hairColor:[],bikiniZone:[]},district:[],price:{from:3000,to:25000,hasExpress:false},services:[],verification:[],other:[],outcall:false};const CityPage=()=>{const{citySlug}=useParams();const navigate=useNavigate();const[profiles,setProfiles]=useState([]);const[cities,setCities]=useState([]);const[selectedCity,setSelectedCity]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[languages]=useState([{id:1,code:'ru',name:'Русский'},{id:2,code:'en',name:'English'}]);const[selectedLanguage,setSelectedLanguage]=useState(languages[0]);const[filters,setFilters]=useState(initialFilters);const[districts,setDistricts]=useState([]);const[services,setServices]=useState([]);// Загрузка городов и поиск текущего города по URL\nuseEffect(()=>{const fetchCities=async()=>{try{const response=await axios.get(`${API_URL}/cities`);setCities(response.data);if(citySlug&&response.data.length>0){// Находим город по слагу URL\nconst city=response.data.find(c=>c.name.toLowerCase().replace(/\\s+/g,'-')===citySlug);if(city){setSelectedCity(city);}else{setError('Город не найден');navigate('/');}}}catch(error){console.error('Ошибка при загрузке городов:',error);setError('Ошибка при загрузке городов');}};fetchCities();},[citySlug,navigate]);// Загрузка анкет по выбранному городу\nuseEffect(()=>{if(!selectedCity)return;const fetchProfiles=async()=>{setLoading(true);setError('');try{const params={cityId:selectedCity.id,filters:JSON.stringify(filters)};const response=await axios.get(`${API_URL}/profiles`,{params});setProfiles(response.data);}catch(error){console.error('Ошибка при загрузке анкет:',error);setError('Ошибка при загрузке анкет');}finally{setLoading(false);}};fetchProfiles();},[selectedCity,filters]);// Загрузка справочников для фильтров\nuseEffect(()=>{if(!selectedCity)return;const fetchFilterData=async()=>{try{const[districtsResponse,servicesResponse]=await Promise.all([axios.get(`${API_URL}/districts/${selectedCity.id}`),axios.get(`${API_URL}/services`)]);setDistricts(districtsResponse.data);setServices(servicesResponse.data);}catch(error){console.error('Ошибка при загрузке данных для фильтров:',error);}};fetchFilterData();},[selectedCity]);const handleCityChange=city=>{const cityUrlSlug=city.name.toLowerCase().replace(/\\s+/g,'-');navigate(`/${cityUrlSlug}`);};const renderContent=()=>{if(loading){return/*#__PURE__*/_jsxs(LoadingContainer,{children:[/*#__PURE__*/_jsx(CircularProgress,{size:60}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.secondary\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0430\\u043D\\u043A\\u0435\\u0442...\"})]});}if(error){return/*#__PURE__*/_jsx(StyledAlert,{severity:\"error\",children:error});}if(profiles.length===0){return/*#__PURE__*/_jsx(StyledAlert,{severity:\"info\",children:\"\\u041F\\u043E \\u0432\\u0430\\u0448\\u0435\\u043C\\u0443 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0443 \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"});}return/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:profiles.map(profile=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(ProfileCard,{profile:profile})},profile.id))});};return/*#__PURE__*/_jsxs(PageContainer,{children:[selectedCity&&/*#__PURE__*/_jsx(CommonSEO,{cityName:selectedCity.name,isHomePage:false}),/*#__PURE__*/_jsx(Header,{cities:cities,languages:languages,selectedCity:selectedCity,selectedLanguage:selectedLanguage,onCityChange:handleCityChange,onLanguageChange:setSelectedLanguage}),/*#__PURE__*/_jsxs(ContentContainer,{maxWidth:\"lg\",children:[selectedCity&&/*#__PURE__*/_jsxs(BreadcrumbsContainer,{children:[/*#__PURE__*/_jsxs(Breadcrumbs,{\"aria-label\":\"breadcrumb\",children:[/*#__PURE__*/_jsx(MuiLink,{color:\"inherit\",href:\"/\",onClick:e=>{e.preventDefault();navigate('/');},children:\"\\u0413\\u043B\\u0430\\u0432\\u043D\\u0430\\u044F\"}),/*#__PURE__*/_jsx(Typography,{color:\"text.primary\",children:selectedCity.name})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",component:\"h1\",mt:2,mb:3,children:[\"\\u041F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0442\\u0443\\u0442\\u043A\\u0438 \",selectedCity.name,\" | \\u042D\\u0441\\u043A\\u043E\\u0440\\u0442 \\u0443\\u0441\\u043B\\u0443\\u0433\\u0438\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",mb:3,color:\"text.secondary\",children:[\"\\u042D\\u043B\\u0438\\u0442\\u043D\\u044B\\u0435 \\u043F\\u0440\\u043E\\u0441\\u0442\\u0438\\u0442\\u0443\\u0442\\u043A\\u0438 \",selectedCity.name,\". \\u041D\\u0430 \\u044D\\u0442\\u043E\\u0439 \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0435 \\u043F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u043B\\u0435\\u043D\\u044B VIP \\u0434\\u0435\\u0432\\u0443\\u0448\\u043A\\u0438 \\u0441 \\u0440\\u0435\\u0430\\u043B\\u044C\\u043D\\u044B\\u043C\\u0438 \\u0444\\u043E\\u0442\\u043E, \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0430\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u0435\\u0439 \\u0441\\u0430\\u0439\\u0442\\u0430. \\u0418\\u043D\\u0434\\u0438\\u0432\\u0438\\u0434\\u0443\\u0430\\u043B\\u043A\\u0438 \",selectedCity.name,\" \\u0441 \\u0432\\u044B\\u0441\\u043E\\u043A\\u0438\\u043C \\u0443\\u0440\\u043E\\u0432\\u043D\\u0435\\u043C \\u0441\\u0435\\u0440\\u0432\\u0438\\u0441\\u0430 \\u0438 \\u0433\\u0430\\u0440\\u0430\\u043D\\u0442\\u0438\\u0435\\u0439 \\u043A\\u043E\\u043D\\u0444\\u0438\\u0434\\u0435\\u043D\\u0446\\u0438\\u0430\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438.\"]})]}),/*#__PURE__*/_jsx(FilterBar,{filters:filters,onFilterChange:setFilters,districts:districts}),renderContent()]})]});};export default CityPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}