#!/bin/bash
set -e

echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö"

# –ù–∞—Ö–æ–¥–∏–º —Ñ–∞–π–ª —Å –æ—à–∏–±–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
find /root/escort-project/client/src -type f -name "*.tsx" -o -name "*.ts" | xargs grep -l "sort((a, b) => (a.order || 0) - (b.order || 0))" | while read -r file; do
  echo "üîç –ù–∞–π–¥–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –±–µ–∑ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ: $file"
  
  # –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
  cp "$file" "${file}.bak_type"
  
  # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª—è—è —è–≤–Ω—ã–µ —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  sed -i 's/sort((a, b) => (a.order || 0) - (b.order || 0))/sort((a: Profile, b: Profile) => (a.order || 0) - (b.order || 0))/g' "$file"
  
  echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ: $file"
done

echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
