#!/bin/bash
set -e

echo "üîß –î–æ–±–∞–≤–ª—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π"

# –ü—É—Ç—å –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
PROFILES_PAGE="/root/escort-project/client/src/pages/admin/ProfilesPage.tsx"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª
if [ -f "$PROFILES_PAGE" ]; then
  cp $PROFILES_PAGE ${PROFILES_PAGE}.bak_loading
  
  # –î–æ–±–∞–≤–ª—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
  # –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏—é fetchProfiles
  if grep -q "fetchProfiles" "$PROFILES_PAGE"; then
    # –î–æ–±–∞–≤–ª—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    sed -i '/const fetchProfiles/a\  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n  const fetchPublicProfiles = async () => {\n    try {\n      setLoading(true);\n      console.log("–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API...");\n      \n      // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API\n      const response = await axios.get(`${API_URL}/profiles`);\n      console.log("–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API:", response.data);\n      \n      setProfiles(response.data);\n      setError("");\n    } catch (err) {\n      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª–µ–π —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API:", err);\n      setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞.");\n    } finally {\n      setLoading(false);\n    }\n  };' "$PROFILES_PAGE"
    
    # –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º useEffect, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π
    sed -i '/useEffect\(\(\) => {/a\    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π API, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è - —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π\n    fetchProfiles().catch(err => {\n      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫–∏–π API, –ø—Ä–æ–±—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π:", err);\n      fetchPublicProfiles();\n    });' "$PROFILES_PAGE"
    
    # –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ fetchProfiles –≤ useEffect
    sed -i '/fetchProfiles();/s/^/\/\/ /' "$PROFILES_PAGE"
    
    echo "‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–æ–±–∞–≤–ª–µ–Ω"
  else
    echo "‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è fetchProfiles –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
  fi
else
  echo "‚ö†Ô∏è –§–∞–π–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ $PROFILES_PAGE"
fi

echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
