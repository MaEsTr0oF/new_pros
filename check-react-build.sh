#!/bin/bash
set -e

echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±–æ—Ä–∫–∏ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–±–æ—Ä–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Nginx:"
docker exec escort-client ls -la /usr/share/nginx/html

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ index.html
echo "üìÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ index.html:"
docker exec escort-client cat /usr/share/nginx/html/index.html | head -30

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏ —Ä–∞–∑–º–µ—Ä JS –∏ CSS —Ñ–∞–π–ª–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º JS –∏ CSS —Ñ–∞–π–ª—ã:"
docker exec escort-client find /usr/share/nginx/html -name "*.js" -o -name "*.css" | xargs ls -lh || true

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:"
docker exec escort-client tail -n 20 /var/log/nginx/access.log || true

# 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞
echo "‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞:"
docker exec escort-client tail -n 20 /var/log/nginx/error.log || true

# 6. –ü–æ–ø—Ä–æ–±—É–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ —Å –≤—ã–≤–æ–¥–æ–º –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
echo "üîÑ –ü—Ä–æ–±—É–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ —Å –≤—ã–≤–æ–¥–æ–º –æ—à–∏–±–æ–∫:"
cd /root/escort-project/client
export CI=false
export SKIP_PREFLIGHT_CHECK=true
export DISABLE_ESLINT_PLUGIN=true
npm run build 2>&1 | tee /tmp/build-output.log || true

echo "üìë –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ /tmp/build-output.log"

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:"
echo "package.json:"
cat package.json | grep -A 20 "dependencies" | head -20

echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo "üîé –î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –º–æ–∂–Ω–æ:"
echo "  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /tmp/build-output.log"
echo "  2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–∞–π—Ç—É"
echo "  3. –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (npm start) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫"
